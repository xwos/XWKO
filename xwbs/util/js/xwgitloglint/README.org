#+STARTUP: showall
#+STARTUP: hidestars
#+TITLE: xwgitloglint-README
#+AUTHOR: 隐星魂(Roy.Sun)
#+EMAIL: roy.sun@starsoul.tech
#+DATE:
#+LANGUAGE: zh-CN
#+OPTIONS: ^:{}
#+OPTIONS: title:nil
#+OPTIONS: toc:nil

* 简介

+ 作用：每次git commit时检查commit log是否符合规范。

* 部署

+ 安装node.js

*husky* 要求 *node* 的版本 >= 10。到官网下载一个合适的版本：
[[https://nodejs.org/zh-cn/download/][https://nodejs.org/zh-cn/download/]]

安装路径可以选择 */usr/local/* 或 *~/.local/* ,大部分Linux发行版的 *PATH* 环境变量
已经包含这两个路径。

安装完成后可使用下面命令测试一下版本号。
#+BEGIN_SRC shell
node -v
npm -v
#+END_SRC

+ 修改npm的仓库源

打开文件 *~/.npmrc* ，增加下列配置，使用国内的镜像。

#+BEGIN_SRC shell
registry = https://registry.npm.taobao.org
#+END_SRC

+ 安装commitlint与husky

#+BEGIN_SRC shell
cd js/xwgitloglint
npm install --save-dev @commitlint/cli \
                       @commitlint/config-conventional \
                       husky
#+END_SRC

* 测试

#+BEGIN_SRC shell
git commit --allow-empty -m "badtype: badsubject"
#+END_SRC

因commit log不符合规范，提交会被 *husky* 中止。

#+BEGIN_SRC shell
husky > commit-msg (node vX.Y.Z)
⧗   input: badtype: badsubject
✖   type must be one of [feat, fix, perf, refactor, style, build, revert, docs, test, chore, milestone, release, developing, patch] [type-enum]

✖   found 1 problems, 0 warnings
ⓘ   Get help: https://github.com/conventional-changelog/commitlint/#what-is-commitlint

husky > commit-msg hook failed (add --no-verify to bypass)
#+END_SRC
